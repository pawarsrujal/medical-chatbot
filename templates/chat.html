<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Chatbot - AI Health Assistant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>üè• Medical Chatbot</h1>
            <p>AI-Powered Health Information Assistant</p>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <h2>Welcome to Medical Chatbot!</h2>
                <p>Ask me anything about medical conditions, symptoms, treatments, or medications.</p>
                <div class="example-questions">
                    <div class="example-question" onclick="askQuestion('What are the symptoms of diabetes?')">What are the symptoms of diabetes?</div>
                    <div class="example-question" onclick="askQuestion('How to prevent heart disease?')">How to prevent heart disease?</div>
                    <div class="example-question" onclick="askQuestion('What is hypertension?')">What is hypertension?</div>
                </div>
            </div>
        </div>

        <div class="chat-input-container">
            <input 
                type="text" 
                id="messageInput" 
                placeholder="Ask a medical question..." 
                onkeypress="handleKeyPress(event)"
            />
            <button id="sendButton" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }

        function addMessage(content, isUser) {
            const chatMessages = document.getElementById('chatMessages');
            const welcomeMessage = chatMessages.querySelector('.welcome-message');
            
            // Remove welcome message on first interaction
            if (welcomeMessage) {
                welcomeMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.innerHTML = `
                ${content}
                <div class="message-time">${getCurrentTime()}</div>
            `;
            
            messageDiv.appendChild(messageContent);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typingIndicator';
            
            const typingContent = document.createElement('div');
            typingContent.className = 'typing-indicator active';
            typingContent.innerHTML = '<span></span><span></span><span></span>';
            
            typingDiv.appendChild(typingContent);
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Add user message
            addMessage(message, true);
            input.value = '';
            
            // Disable send button
            const sendButton = document.getElementById('sendButton');
            sendButton.disabled = true;
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Send message to backend
                const formData = new FormData();
                formData.append('msg', message);
                
                const response = await fetch('/get', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.text();
                
                // Hide typing indicator
                hideTypingIndicator();
                
                // Add bot response
                addMessage(data, false);
                
            } catch (error) {
                hideTypingIndicator();
                addMessage('Sorry, I encountered an error. Please try again.', false);
                console.error('Error:', error);
            } finally {
                sendButton.disabled = false;
                input.focus();
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function askQuestion(question) {
            document.getElementById('messageInput').value = question;
            sendMessage();
        }

        // Focus input on load
        window.onload = function() {
            document.getElementById('messageInput').focus();
        };
    </script>
</body>
</html>